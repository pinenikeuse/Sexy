<!DOCTYPE html>
<html lang="fr">
<head>
    <meta name="google-adsense-account" content="ca-pub-5904049904040571">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mougouli.com - Visionnage de vidéo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Intégration de Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>
    
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --border-radius: 8px;
            --box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f9;
            overflow-x: hidden;
        }
        
        /* Désactiver le zoom */
        html, body {
            touch-action: manipulation;
            overflow-x: hidden;
            width: 100%;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        
        /* Header Styles */
        header {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 15px 0;
            box-shadow: var(--box-shadow);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
        }
        
        #logo {
            width: 120px;
            height: auto;
            margin-right: 15px;
        }
        
        .site-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 24px;
        }
        
        .back-btn {
            padding: 8px 15px;
            background-color: var(--dark-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* Video Player Section */
        .video-player-section {
            margin: 20px 0;
        }
        
        .video-player-container {
            background-color: #000;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            position: relative;
            max-width: 400px; /* Format 9:16 */
            margin: 0 auto;
            height: 711px; /* Hauteur pour format 9:16 */
        }
        
        #videoPlayer {
            width: 100%;
            height: 100%;
            display: block;
            object-fit: cover;
        }
        
        .video-info {
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-top: 20px;
        }
        
        .video-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }
        
        .video-description {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        
        .video-stats {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #666;
        }
        
        .video-actions {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .action-btn {
            padding: 10px 20px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .like-btn, .dislike-btn {
            background-color: #f8f9fa;
            color: #333;
        }
        
        .like-btn:hover, .dislike-btn:hover {
            background-color: #e9ecef;
        }
        
        .like-btn.liked {
            background-color: #e74c3c;
            color: white;
        }
        
        .dislike-btn.disliked {
            background-color: #6c757d;
            color: white;
        }
        
        .share-btn {
            background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
            color: white;
        }
        
        .share-btn:hover {
            opacity: 0.9;
        }
        
        /* Author Section */
        .author-section {
            display: flex;
            align-items: center;
            margin-top: 20px;
            padding: 15px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .author-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            margin-right: 15px;
        }
        
        .author-info {
            flex: 1;
        }
        
        .author-name {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 5px;
        }
        
        .author-stats {
            color: #666;
            font-size: 14px;
        }
        
        .subscribe-btn {
            padding: 8px 15px;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
        }
        
        .subscribe-btn.subscribed {
            background-color: #6c757d;
        }
        
        /* Related Videos */
        .related-videos {
            margin: 40px 0;
        }
        
        .section-title {
            font-family: 'Poppins', sans-serif;
            margin: 20px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            color: var(--dark-color);
        }
        
        .videos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .video-card {
            background-color: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            transition: transform 0.3s ease;
            cursor: pointer;
        }
        
        .video-card:hover {
            transform: translateY(-5px);
        }
        
        /* CORRECTION DES MINIATURES */
        .video-thumbnail {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 66.67%; /* Ratio 3:2 */
            overflow: hidden;
        }
        
        .thumbnail-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            filter: blur(8px);
            transform: scale(1.05);
            z-index: 1;
            transition: all 0.3s ease;
        }
        
        .thumbnail-foreground {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: auto;
            aspect-ratio: 9/16;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            border-radius: 4px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 2;
        }
        
        .video-card:hover .thumbnail-background {
            filter: blur(10px);
            transform: scale(1.1);
        }
        
        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 30px;
            opacity: 0.8;
            transition: opacity 0.3s;
            z-index: 3;
        }
        
        .video-card:hover .play-icon {
            opacity: 1;
        }
        
        .video-info-small {
            padding: 12px;
        }
        
        .video-title-small {
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 16px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .video-author-small {
            font-size: 14px;
            color: var(--primary-color);
        }
        
        .video-stats-small {
            display: flex;
            gap: 10px;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }
        
        /* Comment Section */
        .comments-section {
            margin-top: 40px;
            padding: 20px;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        .comment-form {
            margin-bottom: 30px;
        }
        
        .comment-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            resize: vertical;
            min-height: 80px;
            margin-bottom: 10px;
            font-family: inherit;
        }
        
        .comment-submit-btn {
            padding: 10px 20px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
        }
        
        .comment-submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .comments-list {
            margin-top: 20px;
        }
        
        .comment {
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .comment:last-child {
            border-bottom: none;
        }
        
        .comment-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 16px;
            margin-right: 10px;
        }
        
        .comment-author {
            font-weight: 600;
            font-size: 16px;
        }
        
        .comment-date {
            font-size: 12px;
            color: #999;
            margin-left: 10px;
        }
        
        .comment-content {
            color: #333;
            line-height: 1.5;
        }
        
        /* Modal de partage */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            overflow: auto;
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        .close-modal {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
            background: none;
            border: none;
        }
        
        .close-modal:hover {
            color: var(--accent-color);
        }
        
        .share-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .share-option-btn {
            padding: 12px;
            border: none;
            border-radius: var(--border-radius);
            color: white;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: opacity 0.3s;
        }
        
        .share-option-btn:hover {
            opacity: 0.9;
        }
        
        .share-facebook {
            background-color: #1877F2;
        }
        
        .share-twitter {
            background-color: #1DA1F2;
        }
        
        .share-whatsapp {
            background-color: #25D366;
        }
        
        .share-link {
            background-color: #6c757d;
        }
        
        /* Auth Modal */
        .auth-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10000;
            overflow: auto;
        }
        
        .auth-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 400px;
            box-shadow: var(--box-shadow);
            position: relative;
        }
        
        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .auth-tab {
            padding: 10px 20px;
            cursor: pointer;
            border: none;
            background: none;
            font-weight: 500;
            color: #666;
            flex: 1;
        }
        
        .auth-tab.active {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
        }
        
        .auth-form {
            display: none;
        }
        
        .auth-form.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
        }
        
        .auth-submit-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            margin-top: 10px;
        }
        
        .auth-error {
            color: var(--accent-color);
            margin-top: 10px;
            font-size: 14px;
            display: none;
        }
        
        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 30px 0;
            margin-top: 40px;
        }
        
        .footer-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }
        
        .footer-section {
            flex: 1;
            min-width: 250px;
            margin-bottom: 20px;
        }
        
        .footer-section h4 {
            font-family: 'Poppins', sans-serif;
            margin-bottom: 15px;
            font-size: 18px;
            color: white;
        }
        
        .footer-section p, .footer-section a {
            color: #ddd;
            margin-bottom: 10px;
            display: block;
            text-decoration: none;
        }
        
        .footer-section a:hover {
            color: white;
        }
        
        .copyright {
            text-align: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #555;
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .video-stats {
                flex-wrap: wrap;
            }
            
            .video-actions {
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: stretch;
                gap: 15px;
            }
            
            .video-player-container {
                border-radius: 0;
                max-width: 100%;
                height: auto;
                aspect-ratio: 9/16;
            }
            
            .author-section {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .author-avatar {
                margin-right: 0;
            }
            
            .videos-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .share-options {
                grid-template-columns: 1fr;
            }
            
            .footer-section {
                min-width: 100%;
            }
            
            .thumbnail-foreground {
                width: 60%;
            }
        }
        
        /* Styles pour les icônes de statistiques */
        .video-views {
            color: #3ea6ff;
        }
        
        .video-views i {
            color: #3ea6ff;
        }
        
        .video-date {
            color: #f1c40f;
        }
        
        .video-date i {
            color: #f1c40f;
        }
        
        .video-likes {
            color: #e74c3c;
        }
        
        .video-likes i {
            color: #e74c3c;
        }
        
        .video-dislikes {
            color: #6c757d;
        }
        
        .video-dislikes i {
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo-container">
                    <img id="logo" src="https://raw.githubusercontent.com/pinenikeuse/mougouli/refs/heads/main/1747616058238.jpg" alt="Mougouli Logo">
                    <h1 class="site-title">Mougouli</h1>
                </div>
                <button class="back-btn" onclick="goBack()">
                    <i class="fas fa-arrow-left"></i> Retour à l'accueil
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <!-- Video Player Section -->
        <section class="video-player-section">
            <div class="video-player-container">
                <video id="videoPlayer" controls></video>
            </div>
            
            <div class="video-info">
                <h1 id="videoTitle" class="video-title">Titre de la vidéo</h1>
                <p id="videoDescription" class="video-description">Description de la vidéo...</p>
                
                <div class="video-stats">
                    <div class="stat-item video-views">
                        <i class="fas fa-eye"></i>
                        <span id="videoViews">0</span> vues
                    </div>
                    <div class="stat-item video-date">
                        <i class="far fa-calendar-alt"></i>
                        <span id="videoDate">Date de publication</span>
                    </div>
                    <div class="stat-item video-likes">
                        <i class="fas fa-heart"></i>
                        <span id="videoLikes">0</span> j'aime
                    </div>
                    <div class="stat-item video-dislikes">
                        <i class="fas fa-thumbs-down"></i>
                        <span id="videoDislikes">0</span> je n'aime pas
                    </div>
                </div>
                
                <div class="video-actions">
                    <button id="likeButton" class="action-btn like-btn">
                        <i class="far fa-heart"></i> J'aime
                    </button>
                    <button id="dislikeButton" class="action-btn dislike-btn">
                        <i class="far fa-thumbs-down"></i> Je n'aime pas
                    </button>
                    <button class="action-btn share-btn" onclick="openShareModal()">
                        <i class="fas fa-share-alt"></i> Partager
                    </button>
                </div>
                
                <div class="author-section">
                    <div class="author-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="author-info">
                        <h3 id="authorName" class="author-name">Nom de l'auteur</h3>
                        <p id="authorStats" class="author-stats">0 abonnés • 0 vidéos</p>
                    </div>
                    <button id="subscribeButton" class="subscribe-btn">S'abonner</button>
                </div>
            </div>
        </section>
        
        <!-- Comment Section -->
        <section class="comments-section">
            <h2 class="section-title">Commentaires</h2>
            
            <div class="comment-form">
                <textarea id="commentInput" class="comment-input" placeholder="Ajouter un commentaire..." disabled></textarea>
                <button id="commentSubmit" class="comment-submit-btn" disabled>Commenter</button>
                <p id="commentLoginPrompt" style="color: #666; margin-top: 10px;">Veuillez vous connecter pour commenter</p>
            </div>
            
            <div class="comments-list" id="commentsContainer">
                <!-- Les commentaires seront chargés ici -->
            </div>
        </section>
        
        <!-- Related Videos Section -->
        <section class="related-videos">
            <h2 class="section-title">Vidéos similaires</h2>
            <div class="videos-grid" id="relatedVideosContainer">
                <!-- Les vidéos similaires seront chargées ici -->
            </div>
        </section>
    </div>

    <!-- Modal de partage -->
    <div id="shareModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal('shareModal')">&times;</span>
            <h2>Partager cette vidéo</h2>
            <div class="share-options">
                <button class="share-option-btn share-facebook" onclick="shareVideo('facebook')">
                    <i class="fab fa-facebook"></i> Facebook
                </button>
                <button class="share-option-btn share-twitter" onclick="shareVideo('twitter')">
                    <i class="fab fa-twitter"></i> Twitter
                </button>
                <button class="share-option-btn share-whatsapp" onclick="shareVideo('whatsapp')">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </button>
                <button class="share-option-btn share-link" onclick="copyShareLink()">
                    <i class="fas fa-link"></i> Copier le lien
                </button>
            </div>
        </div>
    </div>

    <!-- Modal d'authentification -->
    <div id="authModal" class="auth-modal">
        <div class="auth-content">
            <span class="close-modal" onclick="closeModal('authModal')">&times;</span>
            <h2>Connexion / Inscription</h2>
            
            <div class="auth-tabs">
                <button class="auth-tab active" onclick="switchAuthTab('login')">Connexion</button>
                <button class="auth-tab" onclick="switchAuthTab('register')">Inscription</button>
            </div>
            
            <form id="loginForm" class="auth-form active">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Mot de passe</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="auth-submit-btn">Se connecter</button>
                <div id="loginError" class="auth-error"></div>
            </form>
            
            <form id="registerForm" class="auth-form">
                <div class="form-group">
                    <label for="registerName">Nom d'utilisateur</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Mot de passe</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirmer le mot de passe</label>
                    <input type="password" id="registerConfirmPassword" required>
                </div>
                <button type="submit" class="auth-submit-btn">S'inscrire</button>
                <div id="registerError" class="auth-error"></div>
            </form>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>À propos de Mougouli</h4>
                    <p>Plateforme de partage de vidéos privées et premium.</p>
                </div>
                <div class="footer-section">
                    <h4>Liens rapides</h4>
                    <a href="index.html">Accueil</a>
                    <a href="#">Vidéos tendance</a>
                    <a href="#">Catégories</a>
                    <a href="#">À propos</a>
                </div>
                <div class="footer-section">
                    <h4>Contact</h4>
                    <a href="mailto:baizemi0039@gmail.com">baizemi0039@gmail.com</a>
                    <p>Pour toute question ou partenariat</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Mougouli. Tous droits réservés.</p>
            </div>
        </div>
    </footer>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCTj9H9KidzwYDr8Onl_UGqxC58ZlGBMfg",
            authDomain: "test-c81f5.firebaseapp.com",
            projectId: "test-c81f5",
            storageBucket: "test-c81f5.firebasestorage.app",
            messagingSenderId: "94288484954",
            appId: "1:94288484954:web:cede6d5cf48ede3806d663",
            measurementId: "G-6WK15KWD4L"
        };
     
        // Initialiser Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const auth = firebase.auth();
        const db = firebase.firestore();
    
        // Variables globales
        let currentVideoId = null;
        let currentVideoData = null;
        let isLiked = false;
        let isDisliked = false;
        let isSubscribed = false;

        // ===== FONCTIONS PRINCIPALES =====
        function initVideoPage() {
            const urlParams = new URLSearchParams(window.location.search);
            currentVideoId = urlParams.get('id');

            if (!currentVideoId) {
                window.location.href = 'index.html';
                return;
            }

            loadVideoData(currentVideoId);
            loadRelatedVideos();
            loadComments();
            setupAuthStateListener();
        }

        function loadVideoData(videoId) {
            db.collection('videos').doc(videoId).get()
                .then((doc) => {
                    if (doc.exists) {
                        currentVideoData = doc.data();
                        currentVideoData.id = doc.id;
                        updateVideoUI(currentVideoData);
                        updateMetaTags(currentVideoData);
                        incrementVideoViews(videoId);
                    } else {
                        console.error("Vidéo non trouvée");
                        window.location.href = 'index.html';
                    }
                })
                .catch((error) => {
                    console.error("Erreur lors du chargement de la vidéo:", error);
                    window.location.href = 'index.html';
                });
        }

        function updateVideoUI(videoData) {
            const videoPlayer = document.getElementById('videoPlayer');
            if (!videoPlayer) return;
            
            // Réinitialiser le lecteur vidéo
            videoPlayer.innerHTML = '';
            const source = document.createElement('source');
            source.src = videoData.videoUrl;
            source.type = 'video/mp4';
            videoPlayer.appendChild(source);
            videoPlayer.load();

            document.getElementById('videoTitle').textContent = videoData.title;
            document.getElementById('videoDescription').textContent = videoData.description;
            document.getElementById('videoViews').textContent = videoData.views || 0;
            document.getElementById('videoLikes').textContent = videoData.likes || 0;
            document.getElementById('videoDislikes').textContent = videoData.dislikes || 0;

            if (videoData.timestamp) {
                const publishDate = new Date(videoData.timestamp.seconds * 1000);
                document.getElementById('videoDate').textContent = publishDate.toLocaleDateString('fr-FR');
            }

            document.getElementById('authorName').textContent = videoData.username;
            loadAuthorStats(videoData.userId);
        }

        function loadAuthorStats(userId) {
            // Charger le nombre de vidéos de l'auteur
            db.collection('videos').where('userId', '==', userId).get()
                .then((querySnapshot) => {
                    const videoCount = querySnapshot.size;
                    
                    // Charger le nombre d'abonnés
                    db.collection('subscribers').where('channelId', '==', userId).get()
                        .then((subscriberSnapshot) => {
                            const subscriberCount = subscriberSnapshot.size;
                            
                            document.getElementById('authorStats').textContent =
                                `${subscriberCount} abonnés • ${videoCount} vidéos`;
                        })
                        .catch((error) => {
                            console.error("Erreur lors du chargement des abonnés:", error);
                        });
                })
                .catch((error) => {
                    console.error("Erreur lors du chargement des statistiques de l'auteur:", error);
                });
        }

        function loadRelatedVideos() {
            const relatedContainer = document.getElementById('relatedVideosContainer');
            if (!relatedContainer) return;
            relatedContainer.innerHTML = '';

            db.collection('videos')
                .orderBy('timestamp', 'desc')
                .limit(6)
                .get()
                .then((querySnapshot) => {
                    let hasRelatedVideos = false;
                    
                    querySnapshot.forEach((doc) => {
                        if (doc.id !== currentVideoId) {
                            hasRelatedVideos = true;
                            const videoData = doc.data();
                            videoData.id = doc.id;
                            createRelatedVideoCard(videoData, relatedContainer);
                        }
                    });
                    
                    if (!hasRelatedVideos) {
                        loadDefaultRelatedVideos(relatedContainer);
                    }
                })
                .catch((error) => {
                    console.error("Erreur lors du chargement des vidéos similaires:", error);
                    loadDefaultRelatedVideos(relatedContainer);
                });
        }

        function createRelatedVideoCard(videoData, container) {
            const videoCard = document.createElement('div');
            videoCard.className = 'video-card';
            videoCard.onclick = () => {
                window.location.href = `video.html?id=${videoData.id}`;
            };
            
            const publishDate = videoData.timestamp
                ? new Date(videoData.timestamp.seconds * 1000).toLocaleDateString('fr-FR')
                : 'Date inconnue';
                
            const thumbnailUrl = videoData.thumbnailUrl || getThumbnailFromVideo(videoData.videoUrl);
            
            // CORRECTION: Utilisation de la nouvelle structure de miniature
            videoCard.innerHTML = `
                <div class="video-thumbnail">
                    <div class="thumbnail-background" style="background-image: url('${thumbnailUrl}')"></div>
                    <div class="thumbnail-foreground" style="background-image: url('${thumbnailUrl}')"></div>
                    <div class="play-icon">
                        <i class="fas fa-play-circle"></i>
                    </div>
                </div>
                <div class="video-info-small">
                    <h3 class="video-title-small">${videoData.title}</h3>
                    <p class="video-author-small">${videoData.username}</p>
                    <div class="video-stats-small">
                        <span class="video-views"><i class="fas fa-eye"></i> ${videoData.views || 0}</span>
                        <span class="video-date"><i class="far fa-calendar-alt"></i> ${publishDate}</span>
                    </div>
                </div>
            `;
            container.appendChild(videoCard);
        }

        function loadDefaultRelatedVideos(container) {
            const defaultVideos = [
                {
                    id: 'default1',
                    videoUrl: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                    title: "Vidéo de démonstration 1",
                    username: "Administrateur",
                    views: 42,
                    timestamp: { seconds: Date.now() / 1000 }
                },
                {
                    id: 'default2',
                    videoUrl: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
                    title: "Vidéo de démonstration 2",
                    username: "Administrateur",
                    views: 28,
                    timestamp: { seconds: Date.now() / 1000 - 86400 }
                },
                {
                    id: 'default3',
                    videoUrl: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4",
                    title: "Vidéo de démonstration 3",
                    username: "Administrateur",
                    views: 35,
                    timestamp: { seconds: Date.now() / 1000 - 172800 }
                }
            ];
            
            defaultVideos.forEach(videoData => {
                createRelatedVideoCard(videoData, container);
            });
        }

        function getThumbnailFromVideo(videoUrl) {
            return "https://via.placeholder.com/300x180/3498db/ffffff?text=Miniature";
        }

        // ===== FONCTIONS D'INTERACTION =====
        function incrementVideoViews(videoId) {
            const viewedVideos = JSON.parse(sessionStorage.getItem('viewedVideos') || '[]');
            if (!viewedVideos.includes(videoId)) {
                const videoRef = db.collection('videos').doc(videoId);
                videoRef.update({
                    views: firebase.firestore.FieldValue.increment(1)
                }).catch(error => {
                    console.error("Erreur lors de l'incrémentation des vues:", error);
                });
                
                viewedVideos.push(videoId);
                sessionStorage.setItem('viewedVideos', JSON.stringify(viewedVideos));
            }
        }

        function checkIfLiked() {
            const user = auth.currentUser;
            if (!user) return;
            
            // Vérifier si l'utilisateur a déjà liké cette vidéo
            db.collection('likes').where('userId', '==', user.uid).where('videoId', '==', currentVideoId).get()
                .then((querySnapshot) => {
                    isLiked = !querySnapshot.empty;
                    updateLikeButton();
                })
                .catch((error) => {
                    console.error("Erreur lors de la vérification du like:", error);
                });
        }

        function checkIfDisliked() {
            const user = auth.currentUser;
            if (!user) return;
            
            // Vérifier si l'utilisateur a déjà disliké cette vidéo
            db.collection('dislikes').where('userId', '==', user.uid).where('videoId', '==', currentVideoId).get()
                .then((querySnapshot) => {
                    isDisliked = !querySnapshot.empty;
                    updateDislikeButton();
                })
                .catch((error) => {
                    console.error("Erreur lors de la vérification du dislike:", error);
                });
        }

        function checkIfSubscribed() {
            const user = auth.currentUser;
            if (!user || !currentVideoData) return;
            
            // Vérifier si l'utilisateur est déjà abonné à cette chaîne
            db.collection('subscribers').where('userId', '==', user.uid).where('channelId', '==', currentVideoData.userId).get()
                .then((querySnapshot) => {
                    isSubscribed = !querySnapshot.empty;
                    updateSubscribeButton();
                })
                .catch((error) => {
                    console.error("Erreur lors de la vérification de l'abonnement:", error);
                });
        }

        function toggleLike() {
            const user = auth.currentUser;
            if (!user) {
                openAuthModal();
                return;
            }
            
            const videoRef = db.collection('videos').doc(currentVideoId);
            const likesElement = document.getElementById('videoLikes');
            const currentLikes = parseInt(likesElement.textContent);
            
            if (isLiked) {
                // Retirer le like
                db.collection('likes').where('userId', '==', user.uid).where('videoId', '==', currentVideoId).get()
                    .then((querySnapshot) => {
                        const batch = db.batch();
                        querySnapshot.forEach((doc) => {
                            batch.delete(doc.ref);
                        });
                        return batch.commit();
                    })
                    .then(() => {
                        return videoRef.update({ 
                            likes: firebase.firestore.FieldValue.increment(-1) 
                        });
                    })
                    .then(() => {
                        isLiked = false;
                        likesElement.textContent = currentLikes - 1;
                        updateLikeButton();
                    })
                    .catch(error => {
                        console.error("Erreur lors du retrait du like:", error);
                    });
            } else {
                // Ajouter un like
                // Si l'utilisateur avait disliké, retirer le dislike d'abord
                if (isDisliked) {
                    toggleDislike();
                }
                
                db.collection('likes').add({
                    userId: user.uid,
                    videoId: currentVideoId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    return videoRef.update({ 
                        likes: firebase.firestore.FieldValue.increment(1) 
                    });
                })
                .then(() => {
                    isLiked = true;
                    likesElement.textContent = currentLikes + 1;
                    updateLikeButton();
                })
                .catch(error => {
                    console.error("Erreur lors de l'ajout du like:", error);
                });
            }
        }

        function toggleDislike() {
            const user = auth.currentUser;
            if (!user) {
                openAuthModal();
                return;
            }
            
            const videoRef = db.collection('videos').doc(currentVideoId);
            const dislikesElement = document.getElementById('videoDislikes');
            const currentDislikes = parseInt(dislikesElement.textContent);
            
            if (isDisliked) {
                // Retirer le dislike
                db.collection('dislikes').where('userId', '==', user.uid).where('videoId', '==', currentVideoId).get()
                    .then((querySnapshot) => {
                        const batch = db.batch();
                        querySnapshot.forEach((doc) => {
                            batch.delete(doc.ref);
                        });
                        return batch.commit();
                    })
                    .then(() => {
                        return videoRef.update({ 
                            dislikes: firebase.firestore.FieldValue.increment(-1) 
                        });
                    })
                    .then(() => {
                        isDisliked = false;
                        dislikesElement.textContent = currentDislikes - 1;
                        updateDislikeButton();
                    })
                    .catch(error => {
                        console.error("Erreur lors du retrait du dislike:", error);
                    });
            } else {
                // Ajouter un dislike
                // Si l'utilisateur avait liké, retirer le like d'abord
                if (isLiked) {
                    toggleLike();
                }
                
                db.collection('dislikes').add({
                    userId: user.uid,
                    videoId: currentVideoId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    return videoRef.update({ 
                        dislikes: firebase.firestore.FieldValue.increment(1) 
                    });
                })
                .then(() => {
                    isDisliked = true;
                    dislikesElement.textContent = currentDislikes + 1;
                    updateDislikeButton();
                })
                .catch(error => {
                    console.error("Erreur lors de l'ajout du dislike:", error);
                });
            }
        }

        function toggleSubscribe() {
            const user = auth.currentUser;
            if (!user || !currentVideoData) {
                openAuthModal();
                return;
            }
            
            if (isSubscribed) {
                // Se désabonner
                db.collection('subscribers').where('userId', '==', user.uid).where('channelId', '==', currentVideoData.userId).get()
                    .then((querySnapshot) => {
                        const batch = db.batch();
                        querySnapshot.forEach((doc) => {
                            batch.delete(doc.ref);
                        });
                        return batch.commit();
                    })
                    .then(() => {
                        isSubscribed = false;
                        updateSubscribeButton();
                        updateAuthorStats();
                    })
                    .catch(error => {
                        console.error("Erreur lors du désabonnement:", error);
                    });
            } else {
                // S'abonner
                db.collection('subscribers').add({
                    userId: user.uid,
                    channelId: currentVideoData.userId,
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                })
                .then(() => {
                    isSubscribed = true;
                    updateSubscribeButton();
                    updateAuthorStats();
                })
                .catch(error => {
                    console.error("Erreur lors de l'abonnement:", error);
                });
            }
        }

        function updateLikeButton() {
            const likeButton = document.getElementById('likeButton');
            if (!likeButton) return;
            
            likeButton.innerHTML = isLiked
                ? '<i class="fas fa-heart"></i> J\'aime'
                : '<i class="far fa-heart"></i> J\'aime';
                
            likeButton.classList.toggle('liked', isLiked);
        }

        function updateDislikeButton() {
            const dislikeButton = document.getElementById('dislikeButton');
            if (!dislikeButton) return;
            
            dislikeButton.innerHTML = isDisliked
                ? '<i class="fas fa-thumbs-down"></i> Je n\'aime pas'
                : '<i class="far fa-thumbs-down"></i> Je n\'aime pas';
                
            dislikeButton.classList.toggle('disliked', isDisliked);
        }

        function updateSubscribeButton() {
            const subscribeButton = document.getElementById('subscribeButton');
            if (!subscribeButton) return;
            
            subscribeButton.textContent = isSubscribed ? 'Abonné' : 'S\'abonner';
            subscribeButton.classList.toggle('subscribed', isSubscribed);
        }

        function updateAuthorStats() {
            if (!currentVideoData) return;
            
            // Recharger les statistiques de l'auteur
            loadAuthorStats(currentVideoData.userId);
        }

        // ===== FONCTIONS DE COMMENTAIRES =====
        function loadComments() {
            const commentsContainer = document.getElementById('commentsContainer');
            if (!commentsContainer) return;
            commentsContainer.innerHTML = '';
            
            db.collection('comments')
                .where('videoId', '==', currentVideoId)
                .orderBy('timestamp', 'desc')
                .get()
                .then((querySnapshot) => {
                    if (querySnapshot.empty) {
                        commentsContainer.innerHTML = '<p style="text-align: center; color: #666;">Aucun commentaire pour le moment.</p>';
                        return;
                    }
                    
                    querySnapshot.forEach((doc) => {
                        const commentData = doc.data();
                        createCommentElement(commentData, commentsContainer);
                    });
                })
                .catch((error) => {
                    console.error("Erreur lors du chargement des commentaires:", error);
                    commentsContainer.innerHTML = '<p style="text-align: center; color: #666;">Erreur lors du chargement des commentaires.</p>';
                });
        }

        function createCommentElement(commentData, container) {
            const comment = document.createElement('div');
            comment.className = 'comment';
            
            const commentDate = commentData.timestamp
                ? new Date(commentData.timestamp.seconds * 1000).toLocaleDateString('fr-FR')
                : 'Date inconnue';
                
            comment.innerHTML = `
                <div class="comment-header">
                    <div class="comment-avatar">
                        ${commentData.userName ? commentData.userName.charAt(0).toUpperCase() : 'U'}
                    </div>
                    <div class="comment-author">${commentData.userName || 'Utilisateur'}</div>
                    <div class="comment-date">${commentDate}</div>
                </div>
                <div class="comment-content">${commentData.content}</div>
            `;
            
            container.appendChild(comment);
        }

        function submitComment() {
            const user = auth.currentUser;
            if (!user) {
                openAuthModal();
                return;
            }
            
            const commentInput = document.getElementById('commentInput');
            const content = commentInput.value.trim();
            
            if (!content) {
                alert('Veuillez écrire un commentaire');
                return;
            }
            
            // Ajouter le commentaire à la base de données
            db.collection('comments').add({
                videoId: currentVideoId,
                userId: user.uid,
                userName: user.displayName || 'Utilisateur',
                content: content,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            })
            .then(() => {
                commentInput.value = '';
                loadComments(); // Recharger les commentaires
            })
            .catch((error) => {
                console.error("Erreur lors de l'ajout du commentaire:", error);
                alert('Une erreur s\'est produite lors de l\'ajout du commentaire');
            );
        }

        // ===== FONCTIONS DE PARTAGE =====
        function openShareModal() {
            document.getElementById('shareModal').style.display = 'block';
        }

        function shareVideo(platform) {
            const shareUrl = window.location.origin + window.location.pathname + '?id=' + currentVideoId;
            const title = "Regardez cette vidéo sur Mougouli: " + currentVideoData.title;
            let shareWindowUrl = '';
            
            switch (platform) {
                case 'facebook':
                    shareWindowUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
                    break;
                case 'twitter':
                    shareWindowUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(shareUrl)}`;
                    break;
                case 'whatsapp':
                    shareWindowUrl = `https://wa.me/?text=${encodeURIComponent(title + ' ' + shareUrl)}`;
                    break;
                default:
                    console.error("Plateforme de partage non reconnue");
                    return;
            }
            
            if (shareWindowUrl) {
                window.open(shareWindowUrl, '_blank', 'width=600,height=400');
            }
            closeModal('shareModal');
        }

        function copyShareLink() {
            const shareUrl = window.location.origin + window.location.pathname + '?id=' + currentVideoId;
            
            navigator.clipboard.writeText(shareUrl)
                .then(() => {
                    alert('Lien copié dans le presse-papiers!');
                    closeModal('shareModal');
                })
                .catch(() => {
                    // Fallback pour les navigateurs qui ne supportent pas clipboard API
                    const textArea = document.createElement('textarea');
                    textArea.value = shareUrl;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = 0;
                    document.body.appendChild(textArea);
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            alert('Lien copié dans le presse-papiers!');
                        } else {
                            alert('Impossible de copier le lien');
                        }
                    } catch (err) {
                        alert('Impossible de copier le lien: ' + err);
                    }
                    
                    document.body.removeChild(textArea);
                    closeModal('shareModal');
                });
        }

        function updateMetaTags(videoData) {
            // Mettre à jour les meta tags pour le référencement et le partage
            document.querySelector('meta[property="og:title"]')?.setAttribute('content', videoData.title + ' - Mougouli');
            document.querySelector('meta[property="og:description"]')?.setAttribute('content', videoData.description.substring(0, 300));
            document.querySelector('meta[property="og:image"]')?.setAttribute('content', videoData.thumbnailUrl || 'https://raw.githubusercontent.com/pinenikeuse/mougouli/main/1747616058238.jpg');
            document.querySelector('meta[property="og:url"]')?.setAttribute('content', window.location.href);
            document.querySelector('meta[property="og:video"]')?.setAttribute('content', videoData.videoUrl);
            
            // Mettre à jour le titre de la page
            document.title = videoData.title + ' - Mougouli';
        }

        // ===== FONCTIONS D'AUTHENTIFICATION =====
        function setupAuthStateListener() {
            auth.onAuthStateChanged((user) => {
                const commentInput = document.getElementById('commentInput');
                const commentSubmit = document.getElementById('commentSubmit');
                const commentLoginPrompt = document.getElementById('commentLoginPrompt');
                
                if (user) {
                    // Utilisateur connecté
                    if (commentInput) commentInput.disabled = false;
                    if (commentSubmit) commentSubmit.disabled = false;
                    if (commentLoginPrompt) commentLoginPrompt.style.display = 'none';
                    
                    // Vérifier les états like/dislike/abonnement
                    checkIfLiked();
                    checkIfDisliked();
                    checkIfSubscribed();
                } else {
                    // Utilisateur non connecté
                    if (commentInput) commentInput.disabled = true;
                    if (commentSubmit) commentSubmit.disabled = true;
                    if (commentLoginPrompt) commentLoginPrompt.style.display = 'block';
                    
                    isLiked = false;
                    isDisliked = false;
                    isSubscribed = false;
                    updateLikeButton();
                    updateDislikeButton();
                    updateSubscribeButton();
                }
            });
        }

        function openAuthModal() {
            document.getElementById('authModal').style.display = 'block';
        }

        function switchAuthTab(tab) {
            document.querySelectorAll('.auth-tab').forEach(button => {
                button.classList.remove('active');
            });
            document.querySelectorAll('.auth-form').forEach(form => {
                form.classList.remove('active');
            });
            
            document.querySelector(`.auth-tab[onclick="switchAuthTab('${tab}')"]`).classList.add('active');
            document.getElementById(tab + 'Form').classList.add('active');
        }

        function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginError');
            
            // Réinitialiser les messages
            errorElement.style.display = 'none';
            
            // Validation
            if (!email || !password) {
                errorElement.textContent = 'Veuillez remplir tous les champs.';
                errorElement.style.display = 'block';
                return;
            }
            
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    closeModal('authModal');
                })
                .catch((error) => {
                    let errorMessage = 'Une erreur est survenue lors de la connexion.';
                    
                    if (error.code === 'auth/invalid-login-credentials') {
                        errorMessage = 'Email ou mot de passe incorrect.';
                    } else if (error.code === 'auth/user-not-found') {
                        errorMessage = 'Aucun utilisateur trouvé avec cet email.';
                    } else if (error.code === 'auth/wrong-password') {
                        errorMessage = 'Mot de passe incorrect.';
                    } else if (error.code === 'auth/too-many-requests') {
                        errorMessage = 'Trop de tentatives de connexion. Veuillez réessayer plus tard.';
                    }
                    
                    errorElement.textContent = errorMessage;
                    errorElement.style.display = 'block';
                });
        }

        function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            const errorElement = document.getElementById('registerError');
            
            // Réinitialiser les messages
            errorElement.style.display = 'none';
            
            // Validation
            if (!name || !email || !password || !confirmPassword) {
                errorElement.textContent = 'Veuillez remplir tous les champs.';
                errorElement.style.display = 'block';
                return;
            }
            
            if (password !== confirmPassword) {
                errorElement.textContent = 'Les mots de passe ne correspondent pas.';
                errorElement.style.display = 'block';
                return;
            }
            
            if (password.length < 6) {
                errorElement.textContent = 'Le mot de passe doit contenir au moins 6 caractères.';
                errorElement.style.display = 'block';
                return;
            }
            
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Mettre à jour le profil avec le nom d'utilisateur
                    return userCredential.user.updateProfile({
                        displayName: name
                    });
                })
                .then(() => {
                    closeModal('authModal');
                })
                .catch((error) => {
                    let errorMessage = 'Une erreur est survenue lors de l\'inscription.';
                    
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage = 'Cet email est déjà utilisé par un autre compte.';
                    } else if (error.code === 'auth/invalid-email') {
                        errorMessage = 'L\'adresse email est invalide.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage = 'Le mot de passe est trop faible.';
                    }
                    
                    errorElement.textContent = errorMessage;
                    errorElement.style.display = 'block';
                });
        }

        // ===== FONCTIONS UTILITAIRES =====
        function goBack() {
            window.history.length > 1 ? window.history.back() : window.location.href = 'index.html';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // ===== INITIALISATION =====
        window.addEventListener('DOMContentLoaded', function () {
            // Vérification que Firebase est correctement configuré
            try {
                if (!firebaseConfig.apiKey || firebaseConfig.apiKey === "AIzaSyCTj9H9KidzwYDr8Onl_UGqxC58ZlGBMfg") {
                    console.warn("Vous utilisez des identifiants Firebase par défaut. Remplacez-les par vos propres identifiants.");
                }
                
                if (typeof db !== 'undefined' && typeof auth !== 'undefined') {
                    initVideoPage();
                } else {
                    const checkFirebase = setInterval(() => {
                        if (typeof db !== 'undefined' && typeof auth !== 'undefined') {
                            clearInterval(checkFirebase);
                            initVideoPage();
                        }
                    }, 100);
                }
            } catch (error) {
                console.error("Erreur d'initialisation Firebase:", error);
                alert("Erreur de configuration Firebase. Vérifiez votre connexion et vos identifiants.");
            }

            // Ajouter les écouteurs d'événements pour les boutons
            const likeButton = document.getElementById('likeButton');
            if (likeButton) {
                likeButton.addEventListener('click', toggleLike);
            }
            
            const dislikeButton = document.getElementById('dislikeButton');
            if (dislikeButton) {
                dislikeButton.addEventListener('click', toggleDislike);
            }
            
            const subscribeButton = document.getElementById('subscribeButton');
            if (subscribeButton) {
                subscribeButton.addEventListener('click', toggleSubscribe);
            }
            
            const commentSubmit = document.getElementById('commentSubmit');
            if (commentSubmit) {
                commentSubmit.addEventListener('click', submitComment);
            }
            
            const commentInput = document.getElementById('commentInput');
            if (commentInput) {
                commentInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        submitComment();
                    }
                });
            }
            
            // Ajouter les écouteurs pour les formulaires d'authentification
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
            }
            
            const registerForm = document.getElementById('registerForm');
            if (registerForm) {
                registerForm.addEventListener('submit', handleRegister);
            }

            // Fermer les modales en cliquant à l'extérieur
            window.addEventListener('click', function (event) {
                const modals = document.querySelectorAll('.modal, .auth-modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>
